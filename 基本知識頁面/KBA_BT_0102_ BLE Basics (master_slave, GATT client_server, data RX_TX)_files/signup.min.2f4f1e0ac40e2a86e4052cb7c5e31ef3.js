(function(c,b){var h=c.Model.extend({modelName:"SignUpModel",createUser:function(a){var g=_.bind(function(){this.trigger("signup:success",{model:this})},this),d=_.bind(function(a){this.trigger("signup:error",a.responseJSON.error)},this);if(this.get("allowCaptcha")){var e=b.grep(a,function(a,b){return":cq:captcha"===a.name}),f=b.grep(a,function(a,b){return":cq:captchakey"===a.name});if(e.length&&f.length){if(_.isEmpty(e[0].value)||_.isEmpty(f[0].value)){this.trigger("signup:error",{message:"Missing Captcha"});
return}e[0].name="captcha";f[0].name="captchakey"}}a.push({name:":operation",value:"social:createTenantUser"});a.push({name:"_charset_",value:"UTF-8"});$.ajax(c.config.urlRoot+this.get("id")+c.constants.URL_EXT,{dataType:"json",type:"POST",xhrFields:{withCredentials:!0},data:a,success:g,error:d})},resendEmail:function(a){var b=_.bind(function(){this.trigger("resend:success",{model:this})},this),d=_.bind(function(a){this.trigger("resend:error",a.responseJSON.error)},this);a.push({name:":operation",
value:"social:resendEmailValidation"});$.ajax(c.config.urlRoot+this.get("id")+c.constants.URL_EXT,{dataType:"json",type:"POST",xhrFields:{withCredentials:!0},data:a,success:b,error:d})}}),k=c.View.extend({viewName:"SignUp",tagName:"div",className:"scf-signup-container",tempRatingBarWidth:null,userNameContainerSel:".scf-username-container",init:function(){this.listenTo(this.model,"signup:success",this.update);this.listenTo(this.model,"signup:error",this.showError);this.$el.find(".form_captcha_refresh input").val(CQ.I18n.get("Refresh"));
this.listenTo(this.model,"resend:success",this.resendSuccess);this.listenTo(this.model,"resend:error",this.resendError)},showError:function(a){this.log.error(a);b(".scf-js-signup-error").text(CQ.I18n.get(a.message)).show()},update:function(){this.log.info("registration successful");b(".scf-js-signup-form").hide();b(".scf-js-signup-success").show()},register:function(a){a.preventDefault();this.comparePasswordFileds()?(b(".scf-js-signup-error").text("").hide(),a=b(".scf-js-signup-form").serializeArray(),
this.model.createUser(a)):b(".scf-js-signup-error").text(CQ.I18n.get("Password fields do not match")).show();return!1},cancel:function(a){a.preventDefault();window.location.href=this.model.attributes.homePageUrl;return!1},confirmPassword:function(a){a.preventDefault();a=b(a.target).parents(".form-group")[0];this.comparePasswordFileds()?b(a).removeClass("has-error"):b(a).addClass("has-error")},comparePasswordFileds:function(){return b(".scf-js-password").val()===b(".scf-js-confirm-password").val()},
toggleUserName:function(a){b(a.target).is(":checked")?(b(this.userNameContainerSel).find('input[type\x3d"text"]').val(""),b(this.userNameContainerSel).removeClass("required").hide()):b(this.userNameContainerSel).addClass("required").show()},resend:function(a){a.preventDefault();b(".scf-js-resend-error").text("").hide();a=b(".scf-js-resend-form").serializeArray();this.model.resendEmail(a);return!1},resendError:function(a){this.log.error(a);b(".scf-js-resend-error").text(a.message).show()},resendSuccess:function(){this.log.info("resend email successful");
b(".scf-js-resend-form").hide();b(".scf-js-resend-success").show()}});c.SignUp=h;c.SignUpView=k;c.registerComponent("social/console/components/hbs/signup",c.SignUp,c.SignUpView)})(SCF,$CQ);