(function(b,a,f,d,c){function h(a,b){var f={},m=CQ.shared.HTTP.getContextPath()+"/content/communities/templates/functions";if(d("#scf-js-notificationsUnreadCount").length){var l=d("#scf-js-notificationsUnreadCount").data("siteurl");l&&!c.Util.startsWith(l,m)&&d.ajax({type:"GET",url:l+"/notifications/jcr:content/content/primary/notifications.social.0.0.json",async:!0,data:f,success:function(c){g=c.unreadCount;e=c.unreadCountConfigured;a&&k===g&&3>b?h(a,b++):(k=g,20!=e?d("#scf-js-notificationsUnreadCount").text(e<
g?e+" +":g):d("#scf-js-notificationsUnreadCount").text(20<g?"20 +":g))}})}}var g=0,k=0,e=20;d(a).ready(function(){h(!1,1);c.Util.listenTo("socialNotificationMarkAsRead",function(c){"all"==c?(g=0,d("#scf-js-notificationsUnreadCount").text(g)):20>=g?(--g,d("#scf-js-notificationsUnreadCount").text(g)):h(!0,1)})})})(window,document,Granite,Granite.$,SCF);
$CQ(document).ready(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var b=function(c){if("undefined"===c||null===c)return"";c=c.split("+").join(" ");var h={},a,b=/[?&]?([^=]+)=([^&]*)/g;for(a=b.exec(c);null!==a;)h[decodeURIComponent(a[1]).trim()]=decodeURIComponent(a[2]),a=b.exec(c);return h}(document.location.search),a=function(c){if("undefined"===c||null===c)return"";for(var a=[],b=/('.*?'|".*?"|\S+)/g,f=0;f<c.length;f++){var e=c[f].trim().match(b);
if(3<=e.length){var d=e[2].trim();"'"==d.charAt(0)&&"'"==d.charAt(d.length-1)&&(d=d.substring(1,d.length-1));e=e[0].trim();a[e]=d}}return a}(function(c){return _.isEmpty(c)?"":c.trim().split(",")}(b.filter));var f=Object.keys?"undefined"===typeof a||null===a?{}:Object.keys(a):$CQ().map(function(c,a){return a});if(null!==b&&void 0!==b){var d=b.expLanguage;null!==d&&void 0!==d&&$CQ(".form-language-select").val(d)}$CQ("input.scf-js-searchresult-value").val(function(){return"undefined"===typeof a||null===
a?"":a[f[0]]});$CQ("input.scf-js-searchresult-jcrtitle").prop("checked",function(){return"undefined"===typeof a||null===a?!1:null!==a["jcr:title"]&&void 0!==a["jcr:title"]?!0:!1});$CQ("input.scf-js-searchresult-jcrdescription").prop("checked",function(){return"undefined"===typeof a||null===a?!1:null!==a["jcr:description"]&&void 0!==a["jcr:description"]?!0:!1});$CQ("input.scf-js-searchresult-tag").prop("checked",function(){return"undefined"===typeof a||null===a?!1:null!==a.tag&&void 0!==a.tag?!0:!1});
$CQ("input.scf-js-searchresult-userIdentifier").prop("checked",function(){return"undefined"===typeof a||null===a?!1:null!==a.userIdentifier&&void 0!==a.userIdentifier?!0:!1});null!==b&&void 0!==b&&null!==b.searchText&&void 0!==b.searchText&&$CQ("input.scf-js-searchresult-value").val(b.searchText);$CQ("form.scf-js-searchresultform").submit(function(c){c.preventDefault();var a=""+$CQ("input.scf-js-searchresult-value").val();c="";(a=a.trim())&&0<a.length&&(c="filter\x3djcr:title like '"+encodeURIComponent(a)+
"'",c+=0<c.length?",":"filter\x3d",c+="jcr:description like '"+encodeURIComponent(a)+"'",c+=0<c.length?", ":"filter\x3d",c+="tag like '"+encodeURIComponent(a)+"'",c+=0<c.length?", ":"filter\x3d",c+="author_display_name like '"+encodeURIComponent(a)+"'",c=c+"\x26expLanguage\x3ddefault"+("\x26searchText\x3d"+encodeURIComponent(a)));if(0<document.URL.indexOf("searchresult.")){a=document.URL.substring(0,document.URL.indexOf("searchresult."))+"searchresult.html?tzOffset\x3d"+(new Date).getTimezoneOffset()+
"\x26"+c;var b=window.location.href}else a=document.URL.substring(0,document.URL.indexOf("search."))+"search.html?tzOffset\x3d"+(new Date).getTimezoneOffset()+"\x26"+c,b=window.location.href.replace(window.location.origin,"");var d=$CQ(this).data("paths");if("undefined"!=typeof d&&null!==d&&0<d.length){d=d.substring(1,d.length-1);var e=d.split(",")}if("undefined"!=typeof e)for(i=0;i<e.length;i++)a+="\x26path\x3d"+e[i].trim();a+="\x26_charset_\x3dutf-8";0<c.length&&(SCF.Router.navigate(b,{trigger:!1}),
window.location.replace(a))});$CQ(".scf-js-searchresult-comment").each(function(){var a=$CQ(this).html();if(100<a.length){var b=a.substr(0,100);a=a.substr(99,a.length-100);b=b+'\x3cspan class\x3d"moreelipses"\x3e...\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"scf-searchresult-morecontent"\x3e\x3cspan\x3e'+a+'\x3c/span\x3e\x26nbsp;\x26nbsp;\x3ca href\x3d"" class\x3d"scf-searchresult-morelink"\x3emore\x3c/a\x3e\x3c/span\x3e';$CQ(this).html(b)}});$CQ(".scf-searchresult-morelink").click(function(){$CQ(this).hasClass("less")?
($CQ(this).removeClass("less"),$CQ(this).html("more")):($CQ(this).addClass("less"),$CQ(this).html("less"));$CQ(this).parent().prev().toggle();$CQ(this).prev().toggle();return!1});$CQ("a.scf-js-searchresult-detaillink").each(function(){var a=$CQ(this).attr("href"),b=a.indexOf("/_jcr_content");if(-1!==b){var d=a.indexOf(".html");d>b&&(b=a.substring(0,b),a=a.substring(d),b+=a,$CQ(this).attr("href",b))}});$CQ(".scf-search-results a.scf-page").click(function(a){a.preventDefault();var b=$(a.currentTarget).data("pageSuffix");
b=b.toString();b=b.split(".");var c=window.location.href;a=$(a.currentTarget).data("baseUrl");var d=c.substring(0,c.indexOf(a)),e=c.indexOf(".html")+5;c=c.substring(e);b=d+a+"."+b[0]+"."+b[1]+".html"+c;c=window.location.href.replace(window.location.origin,"");SCF.Router.navigate(c,{trigger:!1});window.location.href=b})});
$CQ(document).ready(function(){$CQ("form.scf-js-searchform").submit(function(b){b.preventDefault();var a=$(b.target),f=""+a.find("input.scf-js-search-value").val(),d=a.find("input.scf-js-search-jcrtitle").is(":checked"),c=a.find("input.scf-js-search-jcrdescription").is(":checked"),h=a.find("input.scf-js-search-tag").is(":checked"),g=a.find("input.scf-js-search-userIdentifier").is(":checked"),k=a.find(".form-language-select").val();f=f.trim();b="";f&&0<f.length&&(d||c||h||g?(d&&(b="filter\x3djcr:title like '"+
encodeURIComponent(f)+"'"),c&&(b+=0<b.length?",":"filter\x3d",d=$CQ("\x3cdiv/\x3e").text(f).html(),b+="jcr:description like '"+encodeURIComponent(d)+"'"),h&&(b+=0<b.length?", ":"filter\x3d",b+="tag like '"+encodeURIComponent(f)+"'"),g&&(b+=0<b.length?", ":"filter\x3d",b+="author_display_name like '"+encodeURIComponent(f)+"'"),k&&(b=b+("\x26expLanguage\x3d"+k)+("\x26searchText\x3d"+encodeURIComponent(f)))):$(".scf-js-search-danger-alert").show().delay(7500).fadeOut());f=a.find(".scf-js-seach-resultPage").val();
a=a.data("paths");if("undefined"!==typeof a&&null!==a&&0<a.length){a=a.substring(1,a.length-1);var e=a.split(",")}if(0<b.length&&"undefined"!=typeof f&&0<f.length){if("undefined"!=typeof e)for(i=0;i<e.length;i++)b+="\x26path\x3d"+e[i].trim();e=CQ.shared.HTTP.getContextPath();b+="\x26_charset_\x3dutf-8";b=null!==e&&0<e.length?e+"/"+f+".html?tzOffset\x3d"+(new Date).getTimezoneOffset()+"\x26"+b:f+".html?tzOffset\x3d"+(new Date).getTimezoneOffset()+"\x26"+b;SCF.Router.navigate(window.location.href,{trigger:!1});
window.location.replace(b)}})});