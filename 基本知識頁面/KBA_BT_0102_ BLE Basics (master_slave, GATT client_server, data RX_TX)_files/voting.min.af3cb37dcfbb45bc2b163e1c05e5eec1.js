(function(a){window.CQ_Analytics=window.CQ_Analytics||{};var l=window.CQ_Analytics,n=a.Model.extend({ANALYTICS_BASE_RESOURCE_TYPE:"social/commons/components/analyticsbase",modelName:"VotingModel",defaults:{totalNumberOfResponses:0,netCount:0,positiveCount:0,negativeCount:0},_updateVoting:function(a){var b=this.get("currentUserResponse"),e=this.get("netCount"),g=this.get("positiveCount"),f=this.get("negativeCount"),h=this.get("totalNumberOfResponses"),k=this.get("responseTallies")||{};if("unset"===
a){"DISLIKE"===b?(e+=1,f--):"LIKE"===b&&(--e,g--);h--;var c=!1;var d=void 0}else-1==a?("LIKE"===b?(e-=2,f++,g--):(--e,f++,h++),d="DISLIKE",c=!1):1==a&&("DISLIKE"===b?(e+=2,g++,f--):(e+=1,g++,h++),d="LIKE",c=!0);k[1]=g;k[-1]=f;this.set({currentUserResponse:d,currentUserLike:c,netCount:e,positiveCount:g,negativeCount:f,totalNumberOfResponses:h,responseTallies:k},{silent:!0});void 0===d&&this.unset("currentUserResponse",{silent:!0})},createVoting:function(m){var b=a.config.urlRoot+this.get("id")+a.constants.URL_EXT,
e=_.bind(function(b){this._updateVoting(m);this.trigger("voting:added",{model:this});var c=$(".scf-js-site-title").attr("href");this.sitePath=c=_.isUndefined(c)?"":c.substring(0,c.lastIndexOf(".html"));c=this.attributes.properties&&this.attributes.properties["social:parentid"]?this.attributes.properties["social:parentid"]:this.id.split("/voting")[0];var d=a.Model.findLocal(c);b.response.currentUserResponse&&(b=b.response.currentUserResponse,_.isUndefined(window._satellite)?l.Sitecatalyst&&l.record({event:"LIKE"===
b?"SCFVoteUp":"SCFVoteDown",values:{functionType:a.Context.communityFunction?a.Context.communityFunction:d.view.COMMUNITY_FUNCTION,path:a.Context.path?a.Context.path:c,type:a.Context.type?a.Context.type:d.get("resourceType"),ugcTitle:a.Context.ugcTitle?a.Context.ugcTitle:"",siteTitle:a.Context.siteTitle?a.Context.siteTitle:$(".scf-js-site-title").text(),sitePath:a.Context.sitePath?a.Context.sitePath:this.sitePath,groupTitle:a.Context.groupTitle,groupPath:a.Context.groupPath,user:a.Context.user?a.Context.user:
a.Session.get("authorizableId")},collect:!1,componentPath:a.constants.ANALYTICS_BASE_RESOURCE_TYPE}):window._satellite.track("LIKE"===b?"communities-scf-vote-up":"communities-scf-vote-down"))},this),g=_.bind(function(a,b,d){console.log("error creating vote "+d);this.trigger("voting:adderror",{error:d})},this),f={response:m,tallyType:"Voting",":operation":"social:postTallyResponse"},h=this.get("properties");h&&"undefined"!=typeof h.useReferrer&&h.useReferrer&&(f.referer=window.location.href);$.ajax(b,
{dataType:"json",type:"POST",xhrFields:{withCredentials:!0},data:f,success:e,error:g})}}),p=a.View.extend({viewName:"Voting",tagName:"div",className:"voting",init:function(){this.listenTo(this.model,"voting:added",this.update);this.listenTo(this.model,"voting:adderror",this.showError)},update:function(){this.isVoteInProgress=!1;this.render()},showError:function(a){console.log(a)},vote:function(a){if(!this.isVoteInProgress){var b=$CQ(a.target);b.addClass("scf-is-disabled");b=b.attr("data-voting-value");
this.isVoteInProgress=!0;this.model.createVoting(b);a.preventDefault();return!1}}});a.Voting=n;a.VotingView=p;a.registerComponent("social/tally/components/hbs/voting",a.Voting,a.VotingView)})(SCF);